<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AGENDAMENTO DE SALAS</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      text-transform: uppercase;
    }
    .container {
      max-width: 600px;
      margin: 50px auto;
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    form {
      display: flex;
      flex-direction: column;
    }
    label {
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input, select {
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      padding: 10px;
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
    .hidden {
      display: none;
    }
    .action-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .action-buttons button {
      width: 48%;
    }
    .delete-button {
      background-color: #dc3545;
    }
    .delete-button:hover {
      background-color: #c82333;
    }
    .agendamento-visualizacao {
      margin-top: 30px;
      padding: 20px;
      background-color: #e9ecef;
      border-radius: 5px;
      display: none; /* Inicialmente escondido */
    }
    .agendamento-item {
      margin-bottom: 10px;
    }
    .agendamento-item strong {
      color: #333;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>AGENDAMENTO DE SALAS</h1>
    <form id="agendamentoForm">
      
      <label for="finalidade">FINALIDADE:</label>
      <select id="finalidade" required>
        <option value="">SELECIONE A FINALIDADE</option>
        <option value="AULA">AULA</option>
        <option value="TCC">TCC</option>
        <option value="PROVA">PROVA</option>
        <option value="DISCUSSÃO DE CASO">DISCUSSÃO DE CASO</option>
        <option value="REUNIÃO">REUNIÃO</option>
        <option value="MANUTENÇÃO">MANUTENÇÃO</option>
      </select>

      <div id="tccFields" class="hidden">
        <label for="temaTcc">TEMA TCC:</label>
        <input type="text" id="temaTcc" placeholder="DIGITE O TEMA DO TCC">

        <label for="bancaTcc">INTEGRANTES DA BANCA:</label>
        <input type="text" id="bancaTcc" placeholder="DIGITE OS INTEGRANTES DA BANCA">

        <label for="orientadorTcc">ORIENTADOR:</label>
        <select id="orientadorTcc">
          <option value="">SELECIONE O ORIENTADOR</option>
        </select>
      </div>

      <div id="manutencaoFields" class="hidden">
        <label for="motivoManutencao">MOTIVO DA MANUTENÇÃO:</label>
        <input type="text" id="motivoManutencao" placeholder="DIGITE O MOTIVO DA MANUTENÇÃO">
      </div>

      <div id="solicitanteFields" class="hidden">
        <label for="solicitante">SOLICITANTE:</label>
        <select id="solicitante">
          <option value="">SELECIONE O SOLICITANTE</option>
        </select>
      </div>

      <div id="nomeSolicitanteField" class="hidden">
        <label for="nomeSolicitante">NOME DO SOLICITANTE:</label>
        <input type="text" id="nomeSolicitante" placeholder="DIGITE O NOME DO SOLICITANTE">
      </div>

      <label for="sala">ESCOLHA A SALA:</label>
      <select id="sala" required>
        <option value="Sala 1">SALA 1</option>
        <option value="Sala 2">SALA 2</option>
      </select>

      <label for="data">ESCOLHA A DATA:</label>
      <input type="date" id="data" required>

      <label for="hora">ESCOLHA O HORÁRIO:</label>
      <input type="time" id="hora" required>

      <button type="submit" id="agendarButton">AGENDAR</button>

      <!-- Botões de ação para Edição e Exclusão inicialmente escondidos -->
      <div class="action-buttons hidden" id="actionButtons">
        <button type="button" id="editarButton">EDITAR AGENDAMENTO</button>
        <button type="button" id="excluirButton" class="delete-button">EXCLUIR AGENDAMENTO</button>
      </div>
    </form>

    <!-- Seção de visualização do agendamento reservado -->
    <div id="agendamentoVisualizacao" class="agendamento-visualizacao">
      <h3>Agendamento Reservado</h3>
      <div class="agendamento-item"><strong>Finalidade:</strong> <span id="visualizacaoFinalidade"></span></div>
      <div class="agendamento-item"><strong>Solicitante:</strong> <span id="visualizacaoSolicitante"></span></div>
      <div class="agendamento-item hidden" id="visualizacaoNomeSolicitanteContainer"><strong>Nome do Solicitante:</strong> <span id="visualizacaoNomeSolicitante"></span></div>
      <div class="agendamento-item"><strong>Sala:</strong> <span id="visualizacaoSala"></span></div>
      <div class="agendamento-item"><strong>Data:</strong> <span id="visualizacaoData"></span></div>
      <div class="agendamento-item"><strong>Hora:</strong> <span id="visualizacaoHora"></span></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBw3KtxT-386kduvlDLyCHWYsdc_Ny3j9Y",
      authDomain: "agendamento-de-sala-c348d.firebaseapp.com",
      projectId: "agendamento-de-sala-c348d",
      storageBucket: "agendamento-de-sala-c348d.appspot.com",
      messagingSenderId: "1051108935402",
      appId: "1:1051108935402:web:d87c0ce75b27a6908f3993"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let agendamentoId = null; // ID do agendamento selecionado

    const actionButtons = document.getElementById('actionButtons'); // Div com os botões de ação
    const finalidadeSelect = document.getElementById('finalidade');
    const tccFields = document.getElementById('tccFields');
    const manutencaoFields = document.getElementById('manutencaoFields');
    const solicitanteFields = document.getElementById('solicitanteFields');
    const nomeSolicitanteField = document.getElementById('nomeSolicitanteField');
    const solicitanteSelect = document.getElementById('solicitante');
    const nomeSolicitanteInput = document.getElementById('nomeSolicitante');

    // Elementos da visualização do agendamento
    const agendamentoVisualizacao = document.getElementById('agendamentoVisualizacao');
    const visualizacaoFinalidade = document.getElementById('visualizacaoFinalidade');
    const visualizacaoSolicitante = document.getElementById('visualizacaoSolicitante');
    const visualizacaoNomeSolicitanteContainer = document.getElementById('visualizacaoNomeSolicitanteContainer');
    const visualizacaoNomeSolicitante = document.getElementById('visualizacaoNomeSolicitante');
    const visualizacaoSala = document.getElementById('visualizacaoSala');
    const visualizacaoData = document.getElementById('visualizacaoData');
    const visualizacaoHora = document.getElementById('visualizacaoHora');

    // Listas de solicitantes
    const professores = ['Bruna Marcele', 'Danielle Bacarelli', 'Diana Costa', 'Douglas Caragelasco', 'João Flávio', 'Lívia Biazzo', 'Mariana Miranda', 'Marilia Filiponi', 'Marta Luppi', 'Michele Barros', 'Paula Guimarães', 'Paulo Griska', 'Paulo Anselmo', 'Rafael Neves', 'Raphaela Brito'];
    const residentes = ['R1 CLIN. PEQ', 'R2 CLIN. PEQ', 'R1 ANEST', 'R2 ANEST', 'R1 IMAGEM', 'R2 IMAGEM', 'R1 CLIN. GRANDES', 'R2 CLIN. GRANDES'];
    const manutencaoNomes = ['Leandro Biazzo', 'Ellen Gorne'];

    // Função para atualizar as opções de solicitante
    function atualizarSolicitante(finalidade) {
      solicitanteSelect.innerHTML = ''; 
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'SELECIONE O SOLICITANTE';
      solicitanteSelect.appendChild(defaultOption);

      if (finalidade === 'AULA' || finalidade === 'PROVA' || finalidade === 'DISCUSSÃO DE CASO') {
        professores.concat(residentes).forEach(nome => {
          const option = document.createElement('option');
          option.value = nome;
          option.textContent = nome;
          solicitanteSelect.appendChild(option);
        });
      } else if (finalidade === 'TCC') {
        solicitanteSelect.innerHTML = '<option value=""> </option>'; 
      } else if (finalidade === 'MANUTENÇÃO') {
        manutencaoNomes.forEach(nome => {
          const option = document.createElement('option');
          option.value = nome;
          option.textContent = nome;
          solicitanteSelect.appendChild(option);
        });
      }
    }

    // Manipula a mudança de finalidade
    finalidadeSelect.addEventListener('change', function () {
      const finalidade = finalidadeSelect.value;
      tccFields.classList.add('hidden');
      manutencaoFields.classList.add('hidden');
      solicitanteFields.classList.add('hidden');
      nomeSolicitanteField.classList.add('hidden');

      if (finalidade === 'TCC') {
        tccFields.classList.remove('hidden');
        solicitanteFields.classList.remove('hidden');
        atualizarSolicitante(finalidade); 
      } else if (finalidade === 'AULA' || finalidade === 'PROVA' || finalidade === 'DISCUSSÃO DE CASO') {
        solicitanteFields.classList.remove('hidden');
        atualizarSolicitante(finalidade); 
      } else if (finalidade === 'MANUTENÇÃO') {
        manutencaoFields.classList.remove('hidden');
        solicitanteFields.classList.remove('hidden');
        atualizarSolicitante(finalidade); 
      } else if (finalidade === 'REUNIÃO') {
        nomeSolicitanteField.classList.remove('hidden');
      }
    });

    // Função para salvar ou atualizar agendamento
    document.getElementById('agendamentoForm').addEventListener('submit', async function (event) {
      event.preventDefault();

      const finalidade = finalidadeSelect.value;
      const solicitante = solicitanteSelect.value;
      const nomeSolicitante = nomeSolicitanteInput ? nomeSolicitanteInput.value : '';
      const sala = document.getElementById('sala').value;
      const data = document.getElementById('data').value;
      const hora = document.getElementById('hora').value;

      const agendamento = {
        finalidade,
        solicitante,
        nomeSolicitante,
        sala,
        data,
        hora,
      };

      if (finalidade === 'TCC') {
        agendamento.temaTcc = document.getElementById('temaTcc').value;
        agendamento.bancaTcc = document.getElementById('bancaTcc').value;
        agendamento.orientadorTcc = document.getElementById('orientadorTcc').value;
      }

      if (finalidade === 'MANUTENÇÃO') {
        agendamento.motivoManutencao = document.getElementById('motivoManutencao').value;
      }

      try {
        if (agendamentoId) {
          await updateDoc(doc(db, "agendamentos", agendamentoId), agendamento);
          alert('Agendamento atualizado com sucesso!');
        } else {
          const docRef = await addDoc(collection(db, 'agendamentos'), agendamento);
          agendamentoId = docRef.id; // Armazenar o ID do documento recém-criado
          alert('Agendamento realizado com sucesso!');
          actionButtons.classList.remove('hidden'); // Mostrar botões de ação
        }
        document.getElementById('agendamentoForm').reset();

        // Atualizar a visualização do agendamento
        atualizarVisualizacao(agendamento);

      } catch (error) {
        console.error('Erro ao salvar o agendamento:', error);
        alert('Erro ao salvar o agendamento, tente novamente.');
      }
    });

    // Função para carregar um agendamento para edição
    document.getElementById('editarButton').addEventListener('click', async function () {
      if (!agendamentoId) {
        alert('Nenhum agendamento selecionado para edição.');
        return;
      }

      const agendamentoRef = doc(db, "agendamentos", agendamentoId);
      const agendamentoSnap = await getDoc(agendamentoRef);

      if (agendamentoSnap.exists()) {
        const agendamento = agendamentoSnap.data();
        finalidadeSelect.value = agendamento.finalidade;
        solicitanteSelect.value = agendamento.solicitante;
        nomeSolicitanteInput.value = agendamento.nomeSolicitante || '';
        document.getElementById('sala').value = agendamento.sala;
        document.getElementById('data').value = agendamento.data;
        document.getElementById('hora').value = agendamento.hora;

        if (agendamento.finalidade === 'TCC') {
          document.getElementById('temaTcc').value = agendamento.temaTcc;
          document.getElementById('bancaTcc').value = agendamento.bancaTcc;
          document.getElementById('orientadorTcc').value = agendamento.orientadorTcc;
          tccFields.classList.remove('hidden');
        }

        if (agendamento.finalidade === 'MANUTENÇÃO') {
          document.getElementById('motivoManutencao').value = agendamento.motivoManutencao;
          manutencaoFields.classList.remove('hidden');
        }

        atualizarSolicitante(agendamento.finalidade);
        alert('Agendamento carregado para edição.');
        actionButtons.classList.remove('hidden'); // Mostrar botões de ação ao carregar agendamento

        // Atualizar a visualização do agendamento
        atualizarVisualizacao(agendamento);

      } else {
        alert('Nenhum agendamento encontrado para edição.');
      }
    });

    // Função para excluir um agendamento
    document.getElementById('excluirButton').addEventListener('click', async function () {
      if (!agendamentoId) {
        alert('Nenhum agendamento selecionado para exclusão.');
        return;
      }

      try {
        await deleteDoc(doc(db, "agendamentos", agendamentoId));
        alert('Agendamento excluído com sucesso!');
        document.getElementById('agendamentoForm').reset();
        actionButtons.classList.add('hidden'); // Esconder os botões de ação após exclusão
        agendamentoId = null; // Resetar ID após exclusão

        // Esconder a visualização do agendamento
        agendamentoVisualizacao.style.display = 'none';

      } catch (error) {
        console.error('Erro ao excluir o agendamento:', error);
        alert('Erro ao excluir o agendamento, tente novamente.');
      }
    });

    // Função para atualizar a visualização do agendamento
    function atualizarVisualizacao(agendamento) {
      visualizacaoFinalidade.textContent = agendamento.finalidade;
      visualizacaoSolicitante.textContent = agendamento.solicitante || '';
      visualizacaoNomeSolicitante.textContent = agendamento.nomeSolicitante || '';
      visualizacaoSala.textContent = agendamento.sala;
      visualizacaoData.textContent = agendamento.data;
      visualizacaoHora.textContent = agendamento.hora;

      // Mostrar ou esconder o campo "Nome do Solicitante" com base na finalidade
      if (agendamento.finalidade === 'REUNIÃO') {
        visualizacaoNomeSolicitanteContainer.classList.remove('hidden');
      } else {
        visualizacaoNomeSolicitanteContainer.classList.add('hidden');
      }

      // Mostrar a visualização do agendamento
      agendamentoVisualizacao.style.display = 'block';
    }
  </script>

</body>
</html>
